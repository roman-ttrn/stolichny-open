{% extends "store/base.html" %}
{% load static %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'store/css/product_page.css' %}">
{% endblock %}

{% block content %}
<div class="product-detail-container prd-root" data-pid="{{ product.id }}">
  <div class="prd-left">
    <div class="prd-image">
      <img src="{{ product.image.url }}" alt="{{ product.name }}" loading="lazy" width="800" height="800">
    </div>
    {# Можно при желании оставить место для badge (например "Новинка") #}
    {% if product.is_new %}
      <div class="prd-badge">Новинка</div>
    {% endif %}
  </div>

  <div class="prd-right">
    <header class="prd-header">
      <h1 class="prd-title">{{ product.name }}</h1>
      <div class="prd-price">{{ product.price }} ₽</div>
    </header>

    <div class="prd-meta">
      {% if product.weight %}
        <div class="prd-weight">Вес: <span>{{ product.weight }} г</span></div>
      {% endif %}
      {% if product.description %}
        <p class="prd-description">{{ product.description }}</p>
      {% endif %}
    </div>

    <div class="prd-nutrition-wrap">
      <table class="nutrition-table prd-nutrition">
        <thead>
          <tr>
            <th>Белки</th><th>Жиры</th><th>Углеводы</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>{{ product.protein|default:"–" }} г</td>
            <td>{{ product.fat|default:"–" }} г</td>
            <td>{{ product.carbs|default:"–" }} г</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="prd-actions">
      {# Это контейнер контролируемый JS — не трогаем имён классов #}
      <div class="action-wrapper">
        <button class="btn-add" data-pid="{{ product.id }}">Добавить</button>
      </div>

      {# Иконка количества в шапке/корзине обновляется fetch'ем из JS — здесь ничего не нужно #}
    </div>

    {% if request.user.is_staff %}
      <div class="prd-admin">
        <a href="{% url 'product_edit' product.id %}" class="btn-edit" aria-label="Редактировать {{ product.name }}">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04a1.003 1.003 0 000-1.42l-2.34-2.34a1.003 1.003 0 00-1.42 0l-1.83 1.83 3.75 3.75 1.84-1.82z" fill="currentColor"/></svg>
          <span>Редактировать</span>
        </a>

        <form method="post" action="{% url 'product_delete' product.id %}" class="delete-form" novalidate>
          {% csrf_token %}
          <input type="hidden" name="next" value="{{ request.path }}">
          <button type="submit" class="btn-delete" aria-label="Удалить {{ product.name }}">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M6 19a2 2 0 002 2h8a2 2 0 002-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z" fill="currentColor"/></svg>
            <span>Удалить</span>
          </button>
        </form>
      </div>
    {% endif %}

  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{% static 'store/js/product_page.js' %}"></script>
{% endblock %}
