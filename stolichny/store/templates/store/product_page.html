{% extends "store/base.html" %}
{% load static %}

{% block content %}
<div class="product-detail-container" data-pid="{{ product.id }}">
  <div class="product-image">
    <img src="{{ product.image.url }}" alt="{{ product.name }}">
  </div>

  <div class="product-details">
    <h1 class="product-title">{{ product.name }}</h1>
    <p class="product-price">{{ product.price }} ₽</p>

    {% if product.weight %}
    <p class="product-weight">{{ product.weight }} г</p>
    {% endif %}

    {% if product.description %}
    <p class="product-description">{{ product.description }}</p>
    {% endif %}

    <table class="nutrition-table">
      <thead>
        <tr>
          <th>Белки</th><th>Жиры</th><th>Углеводы</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>{{ product.protein|default:"–" }} г</td>
          <td>{{ product.fat|default:"–" }} г</td>
          <td>{{ product.carbs|default:"–" }} г</td>
        </tr>
      </tbody>
    </table>

    <div class="action-wrapper">
      <button class="btn-add" data-pid="{{ product.id }}">Добавить</button>
    </div>
  </div>

  {% if request.user.is_staff %}
    <div class="action-wrapper"> 

      {# Редактирование: обычная ссылка на view редактирования #}
      <a href="{% url 'product_edit' product.id %}" class="btn-edit" aria-label="Редактировать {{ product.name }}">
      <!-- inline SVG и текст -->
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04a1.003 1.003 0 000-1.42l-2.34-2.34a1.003 1.003 0 00-1.42 0l-1.83 1.83 3.75 3.75 1.84-1.82z" fill="currentColor"/></svg>
      <span>Редактировать</span>
      </a>

      {# Удаление: POST-форма с CSRF, никогда не делать удаления через GET #}
      <form method="post" action="{% url 'product_delete' product.id %}" class="delete-form" novalidate>
        {% csrf_token %}
        <input type="hidden" name="next" value="{{ request.path }}"> {# можно вернуть на текущую страницу #}
        <button type="submit" class="btn-delete" aria-label="Удалить {{ product.name }}">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M6 19a2 2 0 002 2h8a2 2 0 002-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z" fill="currentColor"/></svg>
        <span>Удалить</span>
        </button>
      </form>
    </div>
  {% endif %}
</div>
{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'store/css/product_page.css' %}">
{% endblock %}


{% block scripts %}

<script src="{% static 'store/js/product_page.js' %}"></script>

{% endblock %}



